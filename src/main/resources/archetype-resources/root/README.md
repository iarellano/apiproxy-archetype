#set( $H = '#' )
$H API Proxy ${apiproxyName}

$H$H$H Properties generated by Groovy scripts
There are two generated properties worth of mention

```properties
resource.suffix=${deployment.suffix}-rev${target.revision}
shared.resource.name=${apiproxy.name}-${resource.suffix}
```

The meaning of ```target.revision``` is not the same when runing integration testing than runing a deployment, check their
behavior below.

$H$H$H$H compute-next-revision.groovy
This script runs when API Proxy deployment is intended, it computes the next revision to be created by querying
the Management Api for revisions

```properties
target.revision=[Next revision iteration]
resource.suffix=[Use this property to suffix resources name's (caches, kvms)]
shared.resource.name=[Use this property to name resources like a KVM where the configs are stored]
```

$H$H$H$H get-deployed-revision.groovy
This script runs when API Proxy deployment is NOT intended, since it's main purpose is to be used by integration
testing, then if there is not a deployed revision for the given environment then it will fail the build. Unlike the
previous script which also creates property ```target.revision``` this scripts assigns it with the current deployed
revision

```properties
target.revision=[Current deployed revision]
resource.suffix=[Use this property to suffix resources name's (caches, kvms)]
shared.resource.name=[Use this property to name resources like a KVM where the configs are stored]
deployed.revision=[alias for target.revision]
```


$H$H$H Run unit testing on test profile
```bash
mvn -P test test
```

$H$H$H Deploy API Proxy defined by test profile
```bash
mvn -P test,deploy install
```

$H$H$H Deploy resources that depend on API Proxy
```bash
mvn -P test,post-deploy install
```

$H$H$H Run integration testing on API Proxy deployed by test profile
```bash
mvn -P test,integration verify
```

$H$H$H Directory Structure

```
├── build-utils
│   └── groovy $H Groovy scripts to assist building proxies
├── config $H Contains global configurations shared amongst API Proxies and Sharedflows
├── lib $H Contains jars required for JavaCallouts
└── src
    ├── main
    │   ├── gateway $H Contains API Proxies and Sharedflows 
    │   │   ├── ${apiproxyName}
    │   │   │   ├── apiproxy
    │   │   │   │   ├── policies
    │   │   │   │   ├── proxies
    │   │   │   │   ├── resources
    │   │   │   │   └── targets
    │   │   │   ├── callout $H JavaCallout maven project
    │   │   │   ├── config $H API Proxy specific configs
    │   │   │   ├── edge $H API Proxy specific resources
    │   │   │   │   ├── api
    │   │   │   │   ├── env
    │   │   │   │   │   ├── prod
    │   │   │   │   │   └── test
    │   │   │   │   └── org
    │   │   │   ├── template-v1.iml
    │   │   │   └── test
    │   │   │       ├── edge $H API Proxy specific resources for integration testing only
    │   │   │       ├── integration $H Apickli features
    │   │   │       ├── performance $H JMeter files
    │   │   │       └── unit $H JavaScript unit testing
    │   └── resources
    │       └── edge
    │           ├── env
    │           │   ├── prod
    │           │   │   ├── kvms.yaml
    │           │   │   └── targetServers.yaml
    │           │   └── test
    │           │       ├── caches.yaml
    │           │       ├── kvms.yaml
    │           │       └── targetServers.yaml
    │           └── org
    │               ├── apiProducts.yaml
    │               ├── developerApps.yaml
    │               └── developers.yaml
    └── test
        ├── gateway
        │   ├── integration
        │   │   └── features
        │   │       ├── api.feature
        │   │       ├── step_definitions
        │   │       │   ├── apickli-gherkin.js
        │   │       │   ├── developer-apps.js
        │   │       │   └── json-path.js
        │   │       └── support
        │   │           ├── env.js
        │   │           └── init.js
        │   └── unit
        │       ├── jsonComparer.js
        │       ├── mockFactory.js
        │       └── moduleLoader.js
        └── resources
            └── edge
                └── org
                    ├── apiProducts.yaml
                    ├── developerApps.yaml
                    ├── developers.yaml
                    ├── kvms.yaml
                    ├── maskconfigs.yaml
                    └── test.json

```
